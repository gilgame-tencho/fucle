<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>COIN HEX</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px;
      background: #f5f5f5;
    }
    h1 {
      font-size: 2rem;
      color: #333;
      margin-bottom: 20px;
    }
    #controls {
      margin-bottom: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    label {
      margin-right: 15px;
    }
    input {
      width: 60px;
      text-align: right;
      margin-left: 5px;
    }
    canvas {
      border: 2px solid #333;
      background: #fff;
      border-radius: 12px;
      margin-top: 10px;
    }
    button {
      margin-top: 15px;
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    #drawBtn {
      background: #0077cc;
      color: #fff;
    }
    #downloadBtn {
      background: #28a745;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>COIN HEX</h1>
  
  <div id="controls">
    <label>
      頂点数:
      <input type="number" id="vertices" value="6" min="3" max="12">
    </label>
    <label>
      半径:
      <input type="number" id="radius" value="60" min="10" max="300">
    </label>
    <button id="drawBtn" onclick="drawTiling()">描画</button>
  </div>

  <canvas id="canvas" width="800" height="600"></canvas>
  <button id="downloadBtn" onclick="downloadImage()">画像をダウンロード</button>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    // 単一の正多角形を描画する
    function drawPolygon(x, y, radius, vertices, colors) {
      ctx.beginPath();
      for (let i = 0; i <= vertices; i++) {
        const angle = (i * 2 * Math.PI) / vertices - Math.PI / 2;
        const px = x + radius * Math.cos(angle);
        const py = y + radius * Math.sin(angle);
        if (i === 0) {
          ctx.moveTo(px, py);
        } else {
          ctx.lineTo(px, py);
        }
      }
      ctx.closePath();
      // ctx.strokeStyle = "#0077cc";
      ctx.strokeStyle = colors.line;
      ctx.lineWidth = 1.5;
      ctx.stroke();
      // ctx.fillStyle = "rgba(0,119,204,0.08)";
      ctx.fillStyle = colors.fill;
      ctx.fill();
    }

    function drawLine(x1, y1, x2, y2) {
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.closePath();
      ctx.strokeStyle = "#cc0077";
      ctx.lineWidth = 1.5;
      ctx.stroke();
    }

    function drawLines(ps) {
      ctx.beginPath();
      ctx.moveTo(ps[0][0], ps[0][1]);
      for(let i = 1; i < ps.length; i++){
        ctx.lineTo(ps[i][0], ps[i][1]);
      }
      ctx.closePath();
      ctx.strokeStyle = "#cc0077";
      ctx.lineWidth = 1.5;
      ctx.stroke();
    }

    let colors = {line : "#0077cc", fill : "rgba(0,119,204,0.08)"}

    // タイル模様を描画
    function drawTiling() {
      const vertices = parseInt(document.getElementById("vertices").value, 10);
      const radius = parseInt(document.getElementById("radius").value, 10);

      ctx.clearRect(0, 0, canvas.width, canvas.height);


      if (vertices === 6) {
        // array
        let total_var = (6-2)*180/6;
        let rad = 30 * Math.PI / 180;
        let hex_r = Math.cos(rad) * radius; // 六角形の横幅半分
        let step = Math.sin(rad) * radius; // 六角形のTopから肩までの高さ

        let ax_max = Math.ceil((canvas.width - hex_r) / (hex_r * 2)) + 1;
        let ay_max = Math.ceil((canvas.height - (radius / 2)) / (step + radius)) + 1;
        let ary = [];
        for(let i = 0; i < ay_max; i++) {
          ary[i] = [];
          for(let j = 0; j < ax_max; j++) {
            ary[i][j] = Math.round(Math.random(),0);
          }
        }
        console.log(`ax_max: ${ax_max}`);
        console.log(`ay_max: ${ay_max}`);
        console.log(ary);
        console.log(`canvas.width: ${canvas.width}`);
        console.log(`Math.cos(rad): ${Math.cos(rad)}`);
        console.log(`Math.sin(rad): ${Math.sin(rad)}`);
        console.log(`hex_r: ${hex_r}`);
        console.log(`(canvas.width - hex_r): ${(canvas.width - hex_r)}`);
        console.log(`(canvas.width - hex_r) / (hex_r * 2): ${(canvas.width - hex_r) / (hex_r * 2)}`);
        drawLine(50,50, 50+radius, 50);
        drawLine(50,50, 50, 50+radius);
        let dev_b = hex_r *2;
        drawLine(dev_b,dev_b, dev_b+hex_r, dev_b);
        dev_b = hex_r *2 + hex_r;
        drawLine(dev_b,hex_r *2, dev_b, hex_r *2+hex_r);

        // 六角形タイル
        const dx = radius * Math.sqrt(3); // 横方向の間隔
        const dy = radius * 1.5;          // 縦方向の間隔
        // colors = {line : "#0077cc", fill : "rgba(0,119,204,0.08)"};
        let local_colors = {line : "#0077cc", fill : "rgba(0,119,204,0.4)"};

        for (let row = 0; row < Math.ceil(canvas.height / dy) + 1; row++) {
          for (let col = 0; col < Math.ceil(canvas.width / dx) + 1; col++) {
            const x = col * dx + (row % 2) * (dx / 2);
            const y = row * dy;
            if(ary[row][col] == 0){
              drawPolygon(x, y, radius, vertices, colors);
            }else{
              drawPolygon(x, y, radius, vertices, local_colors);
            }
          }
        }
      } else if (vertices === 4) {
        // 四角形タイル（市松）
        const dx = radius * 2;
        const dy = radius * 2;
        for (let row = 0; row < Math.ceil(canvas.height / dy) + 1; row++) {
          for (let col = 0; col < Math.ceil(canvas.width / dx) + 1; col++) {
            const x = col * dx + radius;
            const y = row * dy + radius;
            drawPolygon(x, y, radius, vertices, colors);
          }
        }
      } else if (vertices === 3) {
        // 正三角形タイル
        const dx = radius * Math.sqrt(3);
        const dy = radius * 1.5;
        for (let row = 0; row < Math.ceil(canvas.height / dy) + 1; row++) {
          for (let col = 0; col < Math.ceil(canvas.width / dx) + 1; col++) {
            const x = col * dx + (row % 2) * (dx / 2);
            const y = row * dy;
            drawPolygon(x, y, radius, vertices, colors);
          }
        }
      } else {
        // その他の多角形 → 中央だけ描画（敷き詰め不可）
        drawPolygon(canvas.width / 2, canvas.height / 2, radius, vertices, colors);
      }
    }

    function downloadImage() {
      const link = document.createElement("a");
      link.download = "coin_hex_pattern.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    // 初期描画
    drawTiling();
  </script>
</body>
</html>
